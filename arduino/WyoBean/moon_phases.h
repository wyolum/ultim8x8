const uint32_t NEW_MOON_EPOCH = 1546741792; // Jan 6, 2019 2:29:52
const double MOON_PERIOD =  29.530588853 * 86400;
double get_moon_phase(uint32_t gmt){

  uint32_t seconds = gmt - NEW_MOON_EPOCH;
  double phase = 2 * PI * (seconds / MOON_PERIOD - int(seconds / MOON_PERIOD));
  return phase;
}

const uint8_t N_MOON_PHASE = 43;
const uint8_t MOON_PHASE_STEP = 16;
const uint8_t moon_phases_11x11[N_MOON_PHASE * MOON_PHASE_STEP] = {
  0, 0xf8,0x20,0x88,0x80,0x02,0x18,0xc0,0x00,0x06,0x30,0x80,0x02,0x22,0x08,0x3e,
  1, 0xc0,0x00,0x08,0x80,0x00,0x08,0x40,0x00,0x02,0x10,0x80,0x00,0x02,0x08,0x30,
  2, 0xe0,0x00,0x0c,0xc0,0x00,0x0c,0x60,0x00,0x03,0x18,0xc0,0x00,0x03,0x0c,0x38,
 28, 0xe0,0x00,0x0c,0xc0,0x00,0x0e,0x70,0x80,0x03,0x1c,0xe0,0x00,0x03,0x0c,0x38,
 31, 0xe0,0x00,0x0c,0xe0,0x00,0x0e,0x70,0x80,0x03,0x1c,0xe0,0x80,0x03,0x0c,0x38,
 36, 0xe0,0x00,0x0e,0xe0,0x00,0x0e,0x70,0x80,0x03,0x1c,0xe0,0x80,0x03,0x0e,0x38,
 39, 0xe0,0x00,0x0e,0xe0,0x00,0x0f,0x78,0xc0,0x03,0x1e,0xf0,0x80,0x03,0x0e,0x38,
 44, 0xe0,0x00,0x0e,0xf0,0x00,0x0f,0x78,0xc0,0x03,0x1e,0xf0,0xc0,0x03,0x0e,0x38,
 49, 0xe0,0x00,0x0e,0xf0,0x80,0x0f,0x7c,0xe0,0x03,0x1f,0xf8,0xc0,0x03,0x0e,0x38,
 52, 0xe0,0x00,0x0f,0xf0,0x80,0x0f,0x7c,0xe0,0x03,0x1f,0xf8,0xc0,0x03,0x0f,0x38,
 55, 0xe0,0x00,0x0f,0xf8,0x80,0x0f,0x7c,0xe0,0x03,0x1f,0xf8,0xe0,0x03,0x0f,0x38,
 57, 0xe0,0x00,0x0f,0xf8,0xc0,0x0f,0x7e,0xf0,0x83,0x1f,0xfc,0xe0,0x03,0x0f,0x38,
 66, 0xf0,0x80,0x0f,0xfc,0xe0,0x0f,0x7f,0xf8,0xc3,0x1f,0xfe,0xf0,0x83,0x0f,0x3c,
 74, 0xf0,0x80,0x0f,0xfc,0xf0,0x8f,0x7f,0xfc,0xe3,0x1f,0xff,0xf0,0x83,0x0f,0x3c,
 76, 0xf0,0x80,0x0f,0xfe,0xf0,0x8f,0x7f,0xfc,0xe3,0x1f,0xff,0xf8,0x83,0x0f,0x3c,
 79, 0xf0,0xc0,0x0f,0xfe,0xf0,0x8f,0x7f,0xfc,0xe3,0x1f,0xff,0xf8,0xc3,0x0f,0x3c,
 82, 0xf0,0xc0,0x0f,0xfe,0xf8,0xcf,0x7f,0xfe,0xf3,0x9f,0xff,0xf8,0xc3,0x0f,0x3c,
 87, 0xf8,0xc0,0x0f,0xff,0xf8,0xcf,0x7f,0xfe,0xf3,0x9f,0xff,0xfc,0xc3,0x0f,0x3e,
 92, 0xf8,0xc0,0x0f,0xff,0xfc,0xef,0x7f,0xff,0xfb,0xdf,0xff,0xfc,0xc3,0x0f,0x3e,
 95, 0xf8,0xe0,0x0f,0xff,0xfc,0xef,0x7f,0xff,0xfb,0xdf,0xff,0xfc,0xe3,0x0f,0x3e,
100, 0xf8,0xe0,0x8f,0xff,0xfc,0xef,0x7f,0xff,0xfb,0xdf,0xff,0xfe,0xe3,0x0f,0x3e,
103, 0xf8,0xe0,0x8f,0xff,0xfe,0xff,0xff,0xff,0xff,0xff,0xff,0xfe,0xe3,0x0f,0x3e,
153, 0xf8,0xe0,0x8f,0xff,0xfe,0xff,0xff,0xff,0xff,0xff,0xff,0xfe,0xe3,0x0f,0x3e,
156, 0xf8,0xe0,0x8f,0xff,0xfe,0xf7,0xbf,0xff,0xfd,0xef,0x7f,0xfe,0xe3,0x0f,0x3e,
161, 0xf8,0xe0,0x8f,0x7f,0xfe,0xf7,0xbf,0xff,0xfd,0xef,0x7f,0xfe,0xe1,0x0f,0x3e,
164, 0xf8,0xe0,0x87,0x7f,0xfe,0xf7,0xbf,0xff,0xfd,0xef,0x7f,0xfe,0xe1,0x07,0x3e,
169, 0xf8,0xe0,0x87,0x7f,0xfe,0xf3,0x9f,0xff,0xfc,0xe7,0x3f,0xfe,0xe1,0x07,0x3e,
174, 0x78,0xe0,0x87,0x3f,0xfe,0xf3,0x9f,0xff,0xfc,0xe7,0x3f,0xfe,0xe0,0x07,0x1e,
177, 0x78,0xe0,0x87,0x3f,0xfe,0xf1,0x8f,0x7f,0xfc,0xe3,0x1f,0xfe,0xe0,0x07,0x1e,
180, 0x78,0xe0,0x83,0x3f,0xfe,0xf1,0x8f,0x7f,0xfc,0xe3,0x1f,0xfe,0xe0,0x03,0x1e,
182, 0x78,0xe0,0x83,0x1f,0xfe,0xf1,0x8f,0x7f,0xfc,0xe3,0x1f,0x7e,0xe0,0x03,0x1e,
190, 0x78,0xe0,0x83,0x1f,0xfe,0xf0,0x87,0x3f,0xfc,0xe1,0x0f,0x7e,0xe0,0x03,0x1e,
199, 0x38,0xe0,0x81,0x0f,0x7e,0xf0,0x83,0x1f,0xfc,0xe0,0x07,0x3e,0xe0,0x01,0x0e,
201, 0x38,0xe0,0x81,0x0f,0x3e,0xf0,0x81,0x0f,0x7c,0xe0,0x03,0x3e,0xe0,0x01,0x0e,
204, 0x38,0xe0,0x81,0x07,0x3e,0xf0,0x81,0x0f,0x7c,0xe0,0x03,0x1e,0xe0,0x01,0x0e,
207, 0x38,0xe0,0x80,0x07,0x3e,0xf0,0x81,0x0f,0x7c,0xe0,0x03,0x1e,0xe0,0x00,0x0e,
212, 0x38,0xe0,0x80,0x07,0x1e,0xf0,0x80,0x07,0x3c,0xe0,0x01,0x1e,0xe0,0x00,0x0e,
217, 0x38,0xe0,0x80,0x03,0x1e,0xf0,0x80,0x07,0x3c,0xe0,0x01,0x0e,0xe0,0x00,0x0e,
220, 0x38,0xe0,0x80,0x03,0x0e,0x70,0x80,0x03,0x1c,0xe0,0x00,0x0e,0xe0,0x00,0x0e,
225, 0x38,0x60,0x80,0x03,0x0e,0x70,0x80,0x03,0x1c,0xe0,0x00,0x0e,0x60,0x00,0x0e,
228, 0x38,0x60,0x80,0x01,0x0e,0x70,0x80,0x03,0x1c,0xe0,0x00,0x06,0x60,0x00,0x0e,
254, 0x38,0x60,0x80,0x01,0x06,0x30,0x80,0x01,0x0c,0x60,0x00,0x06,0x60,0x00,0x0e,
255, 0x18,0x20,0x80,0x00,0x02,0x10,0x80,0x00,0x04,0x20,0x00,0x02,0x20,0x00,0x06,
};
